#!/usr/bin/env bash

echo "+ submodules"
cd ~/dotfiles; git pull origin master; git submodule update --init

echo "+ zsh"
rm -rf ~/.zshrc
ln -sf ~/dotfiles/zshrc ~/.zshrc

echo "+ ruby"
rm -rf ~/.gemrc ~/.irbrc ~/.powconfig
ln -sf ~/dotfiles/gemrc ~/.gemrc
ln -sf ~/dotfiles/irbrc ~/.irbrc
ln -sf ~/dotfiles/powconfig ~/.powconfig

echo "+ tmux"
rm -rf ~/.tmux.conf
ln -sf ~/dotfiles/tmux.conf ~/.tmux.conf

echo "+ git"
rm -rf ~/.gitconfig ~/.gitignore-global
ln -sf ~/dotfiles/gitconfig ~/.gitconfig
ln -sf ~/dotfiles/gitignore-global ~/.gitignore-global
# printf "Github token: "
# read token
# sed -i -e "s/GITHUB_TOKEN/$token/g" ~/.gitconfig

# from yoursachet.com
echo "+ vim"
rm -rf ~/.vim ~/.vimrc
ln -sf ~/dotfiles/vimrc ~/.vimrc
ln -sf ~/dotfiles/vim ~/.vim

echo "+ ssh"
rm -rf ~/.ssh
ln -sf ~/dotfiles/ssh ~/.ssh
# fix ssh-keys permission
chmod 600 ~/Dropbox/private/ssh-keys/*

echo "+ sublime settings via package control from dropbox"
mkdir -p ~/Library/Application\ Support/Sublime\ Text\ 2/Installed\ Packages
mkdir -p ~/Library/Application\ Support/Sublime\ Text\ 2/Packages

if [[ ! -e ~/Library/Application\ Support/Sublime\ Text\ 2/Installed\ Packages/Package\ Control.sublime-package ]]; then
  echo "+ install sublime package control"
  curl https://sublime.wbond.net/Package%20Control.sublime-package > ~/Library/Application\ Support/Sublime\ Text\ 2/Installed\ Packages/Package\ Control.sublime-package
fi

if [[ ! -h ~/Library/Application\ Support/Sublime\ Text\ 2/Packages/User ]]; then
  if [[ -e ~/Library/Application\ Support/Sublime\ Text\ 2/Packages/User ]]; then
  	backup_dir="User-$(date +'%Y-%m-%d-%H%M%S').bak"
  	mv ~/Library/Application\ Support/Sublime\ Text\ 2/Packages/User ~/Library/Application\ Support/Sublime\ Text\ 2/Packages/$backup_dir
  fi
  ln -sf ~/Dropbox/private/Sublime/User ~/Library/Application\ Support/Sublime\ Text\ 2/Packages/
fi

if [[ ! -h /usr/bin/subl ]]; then
  echo "+ subl symlink"
  sudo ln -s /Applications/Sublime\ Text\ 2.app/Contents/SharedSupport/bin/subl /usr/bin/
fi
